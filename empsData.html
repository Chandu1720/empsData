<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmpsGetdata</title>
    <style>
         /* body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
    } */
    .modal {
      display: none; 
      position: fixed;
      z-index: 1000;
      inset-inline-start: 0;
      inset-block-start: 0;
      inline-size: 100%;
      block-size: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
    }
    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 20px 30px;
      border-radius: 10px;
      inline-size:  80%;
      max-inline-size: 800px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #007bff;
      color: white;
      padding: 15px;
      border-radius: 10px 10px 0 0;
    }

    .modal-header h2 {
      margin: 0;
    }

    .modal-body {
      padding: 20px 0;
    }

    /* .form-group {
      margin-block-end: 15px;
    } */

    .form-group label {
      display: block;
      font-weight: bold;
      margin-block-end: 5px;
    }

    .form-group input {
      inline-size: 95%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      /* margin-block-start: 5px; */
    }

    .form-row {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .form-row .form-group {
      flex: 1 1 45%;
    }

    .modal-footer {
      text-align: end;
      padding-block-start: 10px;
    }

    .modal-footer button {
     margin-block-start: 10px;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      margin-inline-start: 10px;
      cursor: pointer;
    }

    .btn-primary {
      background-color: #007bff;
      color: white;
    }

    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }

    .close-btn {
      font-size: 20px;
      cursor: pointer;
    }
        table{
            border-collapse: collapse;
            text-align: center;
        }
        th,td{
            align-items: center;
            padding: 10px;
        }
        .btn{
            /* margin:0 25%; */
            margin: 10px;
            margin-block-end: 15px;
            padding: 10px;
            inline-size: 80px;
            color: cornsilk;
            background-color: rgba(255, 4, 4, 0.92);
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }
        #deid,#edid{
            /* margin:0 25%; */
            /* margin: 10px; */
            padding: 10px;
            /* inline-size: 50px; */
            color: cornsilk;
            background-color: rgba(255, 4, 4, 0.92);
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }
          .btn:hover,#deid:hover{
         background-color: rgb(255, 0, 0);
         box-shadow: 1px 1px 4px 2px rgba(0, 0, 0, 0.344);
        }
        .newbtn,#edid{
            background: #0b058b;
        }
          .newbtn:hover,#edid:hover{
         background-color: rgb(2, 8, 90);
         box-shadow: 1px 1px 4px 2px rgba(0, 0, 0, 0.344);
        }
        .row{
            inline-size: 100%;
            display: flex;
            flex-direction: row;
            justify-content: center;
        }

    </style>
</head>
<body>
    <h1>this is emp data </h1>
  <div class="row">
  
          <button type="button" onclick="delAllData()" class="btn">DELALL</button>
    <button type="button" onclick="openModal()" class="btn newbtn">Add Emp</button>
   
  </div>
  <div id="employeeModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="head">Add New Employee</h2>
      <span class="close-btn" onclick="closeModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="employeeForm">
        <div class="form-row">
          <div class="form-group">
            <label>Name</label>
            <input type="text" name="name" id="nameid" placeholder="Enter name">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" name="email" id="mailid" value="user@example.com">
          </div>
          <div class="form-group">
            <label>Mobile Number</label>
            <input type="tel" name="mobile_number" id="numid" placeholder="Enter number">
          </div>
          <div class="form-group">
            <label>Date of Joining</label>
            <input type="date" name="date_of_joinning" id="did" value="2025-05-14">
          </div>
          <div class="form-group">
            <label>Job Role</label>
            <input type="text" name="job_role" id="jid">
          </div>
          <div class="form-group">
            <label>Location</label>
            <input type="text" name="location" id="locid">
          </div>
          <div class="form-group">
            <label>Department</label>
            <input type="text" name="department" id="depid">
          </div>
          <div class="form-group">
            <label>Sub Department</label>
            <input type="text" name="sub_department" id="subid">
          </div>
          <div class="form-group">
            <label>Salary</label>
            <input type="number" name="salary" id="sid">
          </div>
          <div class="form-group">
            <label>Experience (Years)</label>
            <input type="number" name="experience" id="expid">
          </div>
          <div class="form-group">
            <label>Revenue Target</label>
            <input type="number" name="revenue_target" id="revid">
          </div>
          <div class="form-group">
            <label>Onboards</label>
            <input type="number" name="onboards" id="onid">
          </div>
          <div class="form-group" style="flex: 1 1 100%;">
            <label>Reporting To</label>
            <input type="text" name="reporting_to" id="repid">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
          <button type="submit" class="btn-primary"  id="subbtnid" >Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div id="table">
 <table border="2px">
        <thead>
            <tr>
            <th rowspan="2">s.no</th>
            <th rowspan="2">id</th>
            <th rowspan="2">name</th>
            <th rowspan="2">email</th>
            <th rowspan="2">mobile_number</th>
            <th rowspan="2">date_of_joinning</th>
            <th rowspan="2">job_role</th>
            <th rowspan="2">location</th>
            <th rowspan="2">department</th>
            <th rowspan="2">sub_department</th>
            <th rowspan="2">salary</th>
            <th rowspan="2">experience</th>
            <th rowspan="2">revenue_target</th>
            <th rowspan="2">reporting_manager</th>
            <th colspan="2">actions</th>
            </tr>
            <tr>
                <th>EDIT</th>
                <th>DEL</th>
            </tr>
        </thead>
        <tbody id="table-body">
        </tbody>
    </table>
    </div>
</body>
<script>
   function getData()
   {
     let url="https://rms-m7sb.onrender.com/employee/"
    fetch(url)
    .then((res)=>res.json())
    .then((data)=>{
        data.forEach((ele,i) => {
            let tbody=document.getElementById('table-body')
            let row = document.createElement('tr');
            let cell0=document.createElement('td');
            let cell1=document.createElement('td');
            let cell2=document.createElement('td');
            let cell3=document.createElement('td');
            let cell4=document.createElement('td');
            let cell5=document.createElement('td');
            let cell6=document.createElement('td');
            let cell7=document.createElement('td');
            let cell8=document.createElement('td');
            let cell9=document.createElement('td');
            let cell10=document.createElement('td');
            let cell11=document.createElement('td');
            let cell12=document.createElement('td');
            let cell13=document.createElement('td');
            let cell14=document.createElement('td');
            let cell15=document.createElement('td');
           cell15.innerHTML=`<button id="deid" onclick="delData(${ele.id})">DEL</button>`
           cell5.innerHTML=`<button id="edid" onclick="editData(${ele.id})">EDIT</button>`
            cell0.textContent=`${i+1}`
            cell1.textContent=`${ele.id}`
            cell2.textContent=`${ele.name}`
            cell3.textContent=`${ele.email}`
            cell4.textContent=`${ele.mobile_number}`
            cell6.textContent=`${ele.date_of_joinning}`
            cell7.textContent=`${ele.job_role}`
            cell8.textContent=`${ele.location}`
            cell9.textContent=`${ele.department}`
            cell10.textContent=`${ele.sub_department}`
            cell11.textContent=`${ele.salary}`
            cell12.textContent=`${ele.experience}`
            cell13.textContent=`${ele.revenue_target}`
            cell14.textContent = ele.reporting_manager?.name || "N/A";
            row.appendChild(cell0)
            row.appendChild(cell1)
            row.appendChild(cell2)
            row.appendChild(cell3)
            row.appendChild(cell4)
            row.appendChild(cell6)
            row.appendChild(cell7)
            row.appendChild(cell8)
            row.appendChild(cell9)
            row.appendChild(cell10)
            row.appendChild(cell11)
            row.appendChild(cell12)
            row.appendChild(cell13)
            row.appendChild(cell14)
            row.appendChild(cell5)
            row.appendChild(cell15)
            tbody.appendChild(row)
            
        });
    })
    .catch((err)=>console.log(err)
    )
   }
   getData()
    let emps=[]
function openModal() {
    document.getElementById("employeeModal").style.display = "block";
    document.getElementById("subbtnid").setAttribute("onclick","event.preventDefault(); addNew()")
  }

 function closeModal() {
    document.getElementById("employeeModal").style.display = "none";
  }
 function addNew(){
    let name=document.getElementById("nameid").value
    let email=document.getElementById("mailid").value
    let mobile_number=document.getElementById("numid").value
    let date_of_joinning=document.getElementById("did").value
    let job_role=document.getElementById("jid").value
    let location=document.getElementById("locid").value
    let department=document.getElementById("depid").value
    let sub_department=document.getElementById("subid").value
    let salary=document.getElementById("sid").value
    let experience=document.getElementById("expid").value
    let revenue_target=document.getElementById("revid").value
    let onboards=document.getElementById("onid").value
    let reporting_to=document.getElementById("repid").value
    let emp={
                "name": name,
                "email": email,
                "mobile_number": mobile_number,
                "date_of_joinning": date_of_joinning,
                "job_role": job_role,
                "location": location,
                "department": department,
                "sub_department": sub_department,
                "salary": salary,
                "experience": experience,
                "revenue_target": revenue_target,
                "onboards": onboards,
                "reporting_to": reporting_to
           }
           emps.push(emp)
  fetch("https://rms-m7sb.onrender.com/employee/create", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(emp)
  })
    .then((res) => res.json())
    .then((data) => {
      alert("Employee added successfully!");
      document.getElementById("table-body").innerHTML = "";
      getData()
      closeModal();
      console.log(data);
    })
    .catch((err) => {
      console.error("Error:", err);
      alert("Failed to add employee.");
    });
}
function editData(id){
    
    fetch(`https://rms-m7sb.onrender.com/employee/${id}`)
    .then((res)=>res.json())
    .then((data)=>openeditModal(data))
}
function openeditModal(empdata){ console.log(empdata)
    let head=document.getElementById('head')
    head.textContent="Modifey The changes"
    
    let submit=document.getElementById('subbtnid')
submit.setAttribute('onclick', `event.preventDefault(); update(${empdata.id});`);
     document.getElementById("employeeModal").style.display = "block";
     document.getElementById("nameid").value =empdata.name
     document.getElementById("mailid").value=empdata.email
     document.getElementById("numid").value=empdata.mobile_number
     document.getElementById("did").value=empdata.date_of_joinning
     document.getElementById("jid").value=empdata.job_role
     document.getElementById("locid").value=empdata.location
     document.getElementById("depid").value=empdata.department
     document.getElementById("subid").value=empdata.sub_department
     document.getElementById("sid").value=empdata.salary
     document.getElementById("expid").value=empdata.experience
     document.getElementById("revid").value=empdata.revenue_target
     document.getElementById("onid").value=empdata.onboards
     document.getElementById("repid").value=empdata.reporting_manager||"N/A"


}
function update(id){
    let name=document.getElementById("nameid").value
    let email=document.getElementById("mailid").value
    let mobile_number=document.getElementById("numid").value
    let date_of_joinning=document.getElementById("did").value
    let job_role=document.getElementById("jid").value
    let location=document.getElementById("locid").value
    let department=document.getElementById("depid").value
    let sub_department=document.getElementById("subid").value
    let salary=document.getElementById("sid").value
    let experience=document.getElementById("expid").value
    let revenue_target=document.getElementById("revid").value
    let onboards=document.getElementById("onid").value
    let reporting_to="Admin"
    let emp={
                "name": name,
                "email": email,
                "mobile_number": mobile_number,
                "date_of_joinning": date_of_joinning,
                "job_role": job_role,
                "location": location,
                "department": department,
                "sub_department": sub_department,
                "salary": salary,
                "experience": experience,
                "revenue_target": revenue_target,
                "onboards": onboards,
                "reporting_to": reporting_to
           }
           fetch(`https://rms-m7sb.onrender.com/employee/${id}/update`,{
            method:"PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(emp)
           })
           .then((res)=>res.json())
           .then((data)=>{ alert(`${emp.name} is updated`);
             closeModal(); 
             console.log(data);
            })
           .catch((err)=>{ alert(`${emp.name}is not updted `) ;console.log(err)
           })
         
           
}
function delData(id) {
  if (confirm("Are you sure you want to delete this employee?")) {
    fetch(`https://rms-m7sb.onrender.com/employee/${id}/delete`, {
      method: "DELETE"
    })
    .then(res => res.json())
    .then(() => {
      alert("Employee deleted.");
      document.getElementById("table-body").innerHTML = "";
      getData();
    })
    .catch(err => alert("Failed to delete"));
  }
}
function delAllData(){
    if(confirm("Are you sure"))
{
    let table=document.getElementById("table")
    table.innerHTML="<h2>No Data</h2>"
}
}

</script>
</html>